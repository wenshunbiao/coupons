<template>
	<view class="container">
		<v-tabs v-model="current" :tabs="tabs" @change="changeTab" class="tab"></v-tabs>
		<view class="coupon" ref="coupon">
			<view class="item" v-for="(v, i) in couponList" @click="toCoupon(i)" :key="i">
				<view class="top">
					<view class="left">
						<view class="content">
							<image :src="v.icon" class="icon" mode="widthFix" />
							<view class="name">{{ v.name }}</view>
						</view>
						<view class="text" v-if="v.type == 1">å¤©å¤©å¯é¢†</view>
						<view class="text" v-else-if="v.type == 2">é™æ—¶ç§’æ€</view>
					</view>
					<view class="right">å…è´¹é¢†å–</view>
				</view>
				<view class="bottom"><image :src="v.bannerPic" mode="widthFix" /></view>
			</view>
		</view>
	</view>
</template>

<script>
export default {
	data() {
		return {
			current: 0,
			tabs: [
				{
					icon: '/static/all.png',
					text: 'å…¨éƒ¨',
					tabId: 0,
				},
				{
					icon: '/static/ele.png',
					text: 'é¥¿äº†ä¹ˆ',
					tabId: 1,
				},
				{
					icon: '/static/meituan.png',
					text: 'ç¾å›¢',
					tabId: 2,
				},
				// {
				// 	icon: '/static/jd.png',
				// 	text: 'äº¬ä¸œ',
				// 	tabId: 3,
				// },
				// {
				// 	icon: '/static/vip.png',
				// 	text: 'VIPä¼šå‘˜',
				// 	tabId: 4,
				// },
				{
					icon: '/static/12.png',
					text: 'åŒåäºŒ',
					tabId: 5,
				},
			],
			couponList: [],
			coupons: [
				{
					name: 'é¥¿äº†ä¹ˆçº¢åŒ…',
					icon: '/static/coupon/ele.png',
					bannerPic: '/static/coupon/ele_banner.png',
					url: 'https://s.click.ele.me/S4UMXtu',
					type: 1,
					tabId: 1,
					minapp: {
						appid: 'wxece3a9a4c82f58c9',
						path: 'pages/sharePid/web/index?scene=https://s.click.ele.me/S4UMXtu'
					}
				},
				{
					name: 'ç¾å›¢å¤–å–çº¢åŒ…',
					icon: '/static/coupon/meituan.png',
					bannerPic: '/static/coupon/meituan_banner.png',
					url:'https://runion.meituan.com/url?key=cd23768d09c339d1641b2738df39aa67&url=https%3A%2F%2Fi.meituan.com%2Fawp%2Fhfe%2Fblock%2Fa945391288b790d558b7%2F78716%2Findex.html%3Fappkey%3Dcd23768d09c339d1641b2738df39aa67%3Ajuhe&sid=juhe',
					type: 1,
					tabId: 2,
					minapp: {
						appid: 'wxde8ac0a21135c07d',
						path: '/index/pages/h5/h5?weburl=https%3A%2F%2Frunion.meituan.com%2Furl%3Fkey%3D591ec05930c57331c1212b936e6785c1%26url%3Dhttps%253A%252F%252Fi.meituan.com%252Fawp%252Fhfe%252Fblock%252Fa13b87919a9ace9cfab4%252F89400%252Findex.html%253Fappkey%253D591ec05930c57331c1212b936e6785c1%253A000001%26sid%3D000001&lch=cps:waimai:5:591ec05930c57331c1212b936e6785c1:000001&f_token=1&f_userId=1'
					}
				},
				// {
				// 	name: 'çˆ±å¥‡è‰ºä¼šå‘˜',
				// 	icon: '/static/coupon/vip.png',
				// 	bannerPic: '/static/coupon/vip_banner.png',
				// 	url:'https://p.pinduoduo.com/VJ7bHo5d',
				// 	type: 2,
				// 	tabId: 4
				// },
				// {
				// 	name: 'ä¸‰åªæ¾é¼ å¤§ç¤¼åŒ…',
				// 	icon: '/static/coupon/jd.png',
				// 	bannerPic: '/static/coupon/sanzhisongshu.png',
				// 	url:'https://u.jd.com/tFDejq',
				// 	type: 0,
				// 	tabId: 3
				// },
				{
					name: 'é¥¿äº†ä¹ˆæœè”¬',
					icon: '/static/coupon/ele.png',
					bannerPic: '/static/coupon/ele_guosu.png',
					url:'https://s.click.ele.me/ibgcTtu',
					type: 1,
					tabId: 1,
					minapp: {
						appid: 'wxece3a9a4c82f58c9',
						path: 'pages/sharePid/web/index?scene=https://s.click.ele.me/ibgcTtu'
					}
				},
				{
					name: 'æ·˜å®åŒ12â€”ä¸»ä¼šåœº',
					icon: '/static/12.png',
					bannerPic: '/static/coupon/M1IIWtu.jpg',
					url:'https://s.click.taobao.com/M1IIWtu',
					type: 0,
					tabId: 5,
					copy: '7ğŸ‘ˆï¿¥1nT7cL8Fx1Oï¿¥å›ğŸ‘‰ğŸ‘å¯³ğŸ‘ˆæˆ–é»ç¼¶é“¾èŠ‚ https://m.tb.cn/h.45OVJVm è‡³æµè§ˆerã€2020æ·˜å®åŒ12â€”è¶…çº§çº¢åŒ…ä¸»ä¼šåœº(æ¯æ»¡200å‡25ï¼Œæ›´æœ‰æœ€é«˜1212çº¢åŒ…ç­‰ä½ æ¥æŠ¢~ï¼‰ã€‘',
				},
				{
					name: 'å¤©çŒ«åŒ12â€”ä¸»ä¼šåœº',
					icon: '/static/12.png',
					bannerPic: '/static/coupon/4qiHWtu.jpg',
					url:'https://s.click.taobao.com/4qiHWtu',
					type: 0,
					tabId: 5,
					copy: '4ğŸ‘ˆï¿¥eMTtcLj3unVï¿¥å›ğŸ‘‰ğŸ‘å¯³ğŸ‘ˆæˆ–é»ç¼¶é“¾èŠ‚ https://m.tb.cn/h.45Ompu1 è‡³ç‘¬è§ˆå™¨ã€2020å¤©å–µåŒ12â€”ä¸»ä¼šåœºã€‘'
				},
				{
					name: 'å“ç‰Œå¿«æŠ¢',
					icon: '/static/12.png',
					bannerPic: '/static/coupon/5kTjStu.jpg',
					url:'https://s.click.taobao.com/5kTjStu',
					type: 0,
					tabId: 5,
					copy: '1ğŸ‘ˆï¿¥iEekcLj3p4Dï¿¥å™ é–â„¡ğŸ‘‰t~baoğŸ‘ˆæˆ–é»Ì¸å‡»Ì¸urlé“¾ https://m.tb.cn/h.45OmNru è‡³ç‘¬è§ˆå™¨ã€å“ç‰Œå¿«æŠ¢ï¼Œå¤§ç‰Œæ”¾ä»·å¤©å¤©æœ‰3æŠ˜ã€‘'
				},
				{
					name: 'ç“œåˆ†åƒäº¿æ·˜é‡‘å¸',
					icon: '/static/12.png',
					bannerPic: '/static/coupon/T6MHWtu.png',
					url:'https://s.click.taobao.com/T6MHWtu',
					type: 0,
					tabId: 5,
					copy: '3ğŸ‘ˆï¿¥7QDjcLj3jazï¿¥å›ğŸ‘‰tbğŸ‘ˆæˆ–é»Ò‰å‡»Ò‰é“¾èŠ‚ https://m.tb.cn/h.4fgFUwR è‡³ç‘¬è§ˆå™¨ã€æ·˜å®åŒ12-äº’åŠ¨ç©æ³•ï¼Œç“œåˆ†åƒäº¿æ·˜é‡‘å¸ã€‘'
				},
				{
					name: 'èšåˆ’ç®—å¹´ç»ˆç››å…¸',
					icon: '/static/12.png',
					bannerPic: '/static/coupon/kfBHWtu.jpg',
					url:'https://s.click.taobao.com/kfBHWtu',
					type: 0,
					tabId: 5,
					copy: '6.0ï¿¥7imZcLj3n2xï¿¥å›ğŸ‘‰ğŸ‘å¯³ğŸ‘ˆæˆ–é»Ì¸å‡»Ì¸urlé“¾ https://m.tb.cn/h.4U0kfPM è‡³ç‘¬è§ˆå™¨ã€12.12èšåˆ’ç®—å¹´ç»ˆç››å…¸ã€‘'
				},
				{
					name: 'åŒ12å…¨çƒå°–è´§',
					icon: '/static/12.png',
					bannerPic: '/static/coupon/oVhGWtu.jpg',
					url:'https://s.click.taobao.com/oVhGWtu',
					type: 0,
					tabId: 5,
					copy: '7ğŸ‘ˆï¿¥q9V2cLj3YHdï¿¥å™ é–â„¡ğŸ‘‰t~baoğŸ‘ˆæˆ–é»å‡ urlé“¾ https://m.tb.cn/h.4fgwcv4 è‡³æµè§ˆerã€åŒ12å…¨çƒå°–è´§ã€‘'
				},
				{
					name: 'åŒ12å®˜æ–¹ç›´è¥',
					icon: '/static/12.png',
					bannerPic: '/static/coupon/PECGWtu.jpg',
					url:'https://s.click.taobao.com/PECGWtu',
					type: 0,
					tabId: 5,
					copy: '7ğŸ‘ˆï¿¥hz10cLjeVxbï¿¥å›ğŸ‘‰ğŸ‘å¯³ğŸ‘ˆæˆ–é»Ò‰å‡»Ò‰é“¾èŠ‚ https://m.tb.cn/h.45OmNyP è‡³æµè§ˆerã€å¤©å–µå›½é™…ç›´è¥åŒåäºŒç°è´§æ»¡600å‡300ã€‘'
				},
			]
		};
	},
	onLoad(e) {
		//#ifdef H5
		let tabId = this.$route.query.tabId ? parseInt(this.$route.query.tabId) : 0
		//#endif
		//#ifdef MP-WEIXIN
		let tabId = e.tabId ? parseInt(e.tabId) : 0
		//#endif
		for(let i in this.tabs){
			if(tabId == this.tabs[i].tabId){
				this.current = parseInt(i)
			}
		}
		this.changeTab(this.current)
	},
	onShareAppMessage(res) {
		var messages = [{
			title: 'ç¾å›¢é¥¿äº†ä¹ˆå¤§é¢çº¢åŒ…ï¼Œæ¯æ—¥å¯é¢†ï¼',
			path: '/pages/index/index'
		},{
			title: 'åƒäº†è¿™ä¹ˆå¤šå¹´å¤–å–ï¼Œä½ çŸ¥é“è¿™ä¸ªç§˜å¯†å—ï¼Ÿ',
			path: '/pages/index/index'
		}];
		return messages[Math.floor(Math.random()*messages.length)];
	},
	methods: {
		changeTab(index) {
			console.log('å½“å‰é€‰ä¸­çš„é¡¹ï¼š' + index);
			this.couponList = []
			uni.showLoading({
			    title: 'è·å–ä¼˜æƒ ä¸­'
			});
			if(index == 0){
				this.couponList = this.coupons
			}else{
				for(let i in this.coupons){
					if(this.coupons[i].tabId == this.tabs[index].tabId){
						this.couponList.push(this.coupons[i])
					}
				}
			}
			//#ifdef H5
			this.$nextTick(() => {
				this.$refs.coupon.scrollTop= 0;
			})
			//#endif
			setTimeout(() => {
				uni.hideLoading()
			}, 500)
		},
		toCoupon(i){
			console.log(this.couponList[i])
			//h5
			//#ifdef H5
			window.location.href = this.couponList[i].url
			//#endif
			//å¾®ä¿¡å°ç¨‹åº
			//#ifdef MP-WEIXIN
			if(this.couponList[i].minapp){
				wx.navigateToMiniProgram({
				  appId: this.couponList[i].minapp.appid,
				  path: this.couponList[i].minapp.path,
				  success(res) {
					// æ‰“å¼€æˆåŠŸ
				  }
				})
			}
			if(this.couponList[i].copy){
				// è®¾ç½®å‰ªåˆ‡æ¿å†…å®¹
				wx.setClipboardData({
				    data: this.couponList[i].copy,
				    success (res) {
						wx.getClipboardData({
						    success (res) {
						        console.log(res.data) // data
						    }
						})
						wx.hideToast()
						uni.showModal({
						    title: 'æ·˜å£ä»¤å·²ç»å¤åˆ¶',
							content: 'è¯·æ‰“å¼€ã€æ‰‹æœºæ·˜å®/å¤©çŒ«ã€‘è·å–æ´»åŠ¨è¯¦æƒ…å§ï¼',
							showCancel: false
						});
				    }
				})
			}
			//#endif
		}
	}
};
</script>

<style lang="scss">
page {
	background-color: #f8f8f8;
}
.container {
	font-size: 14px;
	line-height: 24px;
	position: relative;
	.tab {
		position: fixed;
		top: var(--window-top);
		left: 0;
		z-index: 9999;
	}
	.coupon {
		padding-top: 200rpx;
		.item {
			background-color: #ffffff;
			margin: 30rpx;
			border-radius: 10rpx;
			padding: 0 30rpx 30rpx 30rpx;
			.top {
				height: 116rpx;
				display: flex;
				align-items: center;
				justify-content: space-between;
				.left {
					height: 116rpx;
					width: 400rpx;
					display: flex;
					align-items: center;
					justify-content: space-between;
					.content {
						width: 100%;
					}
					.icon {
						display: inline-block;
						vertical-align: bottom;
						width: 52rpx;
						height: auto;
					}
					.name {
						text-align: left;
						display: inline-block;
						vertical-align: bottom;
						font-size: 34rpx;
						color: #000;
						line-height: 50rpx;
						font-weight: bold;
						margin-left: 15rpx;
					}
					.text {
						width: 150rpx;
						height: 38rpx;
						line-height: 38rpx;
						text-align: center;
						font-size: 24rpx;
						color: #61300e;
						background: linear-gradient(90deg, #f9db8d, #f8d98a);
						border-radius: 6rpx;
					}
				}

				.right {
					width: 170rpx;
					height: 60rpx;
					border-radius: 30rpx;
					background: linear-gradient(90deg, #ec6f43, #ea4a36);
					color: #fff;
					font-size: 28rpx;
					line-height: 60rpx;
					text-align: center;
				}
			}

			.bottom {
				height: auto;
				width: 100%;
				image {
					display: block;
					width: 100%;
					height: auto;
				}
			}
		}
	}
}
</style>
